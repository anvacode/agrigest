<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>Panel de Gestión Agrícola</h1>
    <div class="header-actions">
      <button class="btn-primary" [class.active]="activeTab === 'farms'" (click)="activeTab = 'farms'">
        <i class="fas fa-tractor"></i> Fincas
      </button>
      <button class="btn-primary" [class.active]="activeTab === 'crops'" (click)="activeTab = 'crops'">
        <i class="fas fa-seedling"></i> Cultivos
      </button>
      <button class="btn-primary" [class.active]="activeTab === 'reports'" (click)="activeTab = 'reports'">
        <i class="fas fa-chart-bar"></i> Reportes
      </button>
    </div>
  </header>

  <!-- Loading y mensajes de error -->
  <div *ngIf="loading" class="loading-spinner">
    <i class="fas fa-spinner fa-spin"></i> Cargando datos...
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <!-- Sección de Fincas -->
  <div *ngIf="activeTab === 'farms'" class="tab-content">
    <div class="section-header">
      <h2>Gestión de Fincas</h2>
      <button routerLink="/farms/new" class="btn-add">
        <i class="fas fa-plus"></i> Nueva Finca
      </button>
    </div>

    <div class="summary-cards">
      <div class="summary-card">
        <h3>Total Fincas</h3>
        <p>{{ farms.length }}</p>
      </div>
      <div class="summary-card">
        <h3>Área Total</h3>
        <p>{{ calculateTotalArea() }} hectáreas</p>
      </div>
      <div class="summary-card">
        <h3>Próximas Actividades</h3>
        <p>3 pendientes</p>
      </div>
    </div>

    <section class="farms-section">
      <h2>Tus Fincas</h2>
      <div class="farms-grid">
        <div *ngFor="let farm of farms" class="farm-card" routerLink="/farms/{{farm.id}}">
          <h3>{{ farm.name }}</h3>
          <p><i class="fas fa-map-marker-alt"></i> {{ farm.location }}</p>
          <p><i class="fas fa-arrows-alt"></i> {{ farm.size }} hectáreas</p>
          <div class="crops-tags">
            <span *ngFor="let crop of farm.crops" class="crop-tag">{{ crop }}</span>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Sección de Cultivos CRUD -->
  <div *ngIf="activeTab === 'crops'" class="tab-content">
    <div class="section-header">
      <h2>Gestión de Cultivos</h2>
      <button class="btn-add" (click)="openCropModal()">
        <i class="fas fa-plus"></i> Nuevo Cultivo
      </button>
    </div>

    <div class="crud-grid">
      <div class="crud-card" *ngFor="let crop of crops">
        <div class="crud-content">
          <h3>{{ crop.nombre }}</h3>
          <p>Tipo: {{ crop.variedad }}</p>
          <p>Ciclo: {{ crop.ciclo_dias }} días</p>
          <div class="requirements-tags">
            <span *ngFor="let req of crop.requerimientos" class="requirement-tag">{{ req }}</span>
          </div>
        </div>
        <div class="crud-actions">
          <button class="btn-icon" (click)="openCropModal(crop)">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn-icon danger" (click)="deleteCrop(crop._id)">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Sección de Reportes con Agregaciones -->
  <div *ngIf="activeTab === 'reports'" class="tab-content">
    <div class="section-header">
      <h2>Reportes Analíticos</h2>
    </div>

    <div class="reports-grid">
      <!-- Reporte 1: Rendimiento por parcela -->
      <div class="report-card">
        <div class="report-header">
          <i class="fas fa-chart-line"></i>
          <h3>Rendimiento por Parcela</h3>
        </div>
        <div class="report-body">
          <canvas id="yieldChart"></canvas>
        </div>
        <div class="report-footer">
          <button class="btn-link" (click)="generateYieldReport()">
            <i class="fas fa-sync-alt"></i> Actualizar Datos
          </button>
        </div>
      </div>

      <!-- Reporte 2: Requerimientos comunes -->
      <div class="report-card">
        <div class="report-header">
          <i class="fas fa-clipboard-list"></i>
          <h3>Requerimientos de Cultivos</h3>
        </div>
        <div class="report-body">
          <ul class="requirements-list">
            <li *ngFor="let req of requirements">
              {{ req._id }} <span class="badge">{{ req.total }}</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Cultivos -->
  <div class="modal-overlay" *ngIf="selectedCrop">
    <div class="modal">
      <h3>{{ selectedCrop._id ? 'Editar' : 'Nuevo' }} Cultivo</h3>
      <div class="form-group">
        <label>Nombre:</label>
        <input type="text" [(ngModel)]="selectedCrop.nombre" placeholder="Ej: Maíz">
      </div>
      <div class="form-group">
        <label>Variedad:</label>
        <input type="text" [(ngModel)]="selectedCrop.variedad" placeholder="Ej: Híbrido X">
      </div>
      <div class="form-group">
        <label>Ciclo (días):</label>
        <input type="number" [(ngModel)]="selectedCrop.ciclo_dias" placeholder="Ej: 90">
      </div>
      <div class="form-group">
        <label>Requerimientos (separados por coma):</label>
        <input type="text" [(ngModel)]="selectedCrop.requerimientosStr" placeholder="Ej: Riego frecuente, Fertilizante">
      </div>
      <div class="modal-actions">
        <button class="btn-save" (click)="saveCrop()">
          <i class="fas fa-save"></i> Guardar
        </button>
        <button class="btn-cancel" (click)="selectedCrop = null">
          <i class="fas fa-times"></i> Cancelar
        </button>
      </div>
    </div>
  </div>
</div>